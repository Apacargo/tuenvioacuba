<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rastreo ‚Ä¢ Apacargo</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
<header>üì¶ Rastreo de Env√≠os ‚Äî Apacargo</header>
<main>
  <h2>Consulta tu env√≠o</h2>
  <input id="trackId" placeholder="Ej: AP-2025-000123" />
  <button onclick="trackLookup()">Rastrear</button>
  <div id="trackResult"></div>
</main>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

const SUPABASE_URL = "https://nqzpmhlxknbtkthifzqt.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xenBtaGx4a25idGt0aGlmenF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyNTE4ODgsImV4cCI6MjA3NjgyNzg4OH0.1JQTXbdTslRUz9VTeXB5rq6I-aKhdQ-lDC51QMpMGqU";
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

async function trackLookup() {
  const id = document.getElementById("trackId").value.trim();
  const result = document.getElementById("trackResult");

  if(!id){ result.innerHTML="‚ö†Ô∏è Ingresa un c√≥digo"; return; }

  const { data, error } = await supabase.from("rastreo")
    .select("*")
    .eq("codigo", id)
    .limit(1)
    .single();

  if(error) { result.innerHTML="üö´ Error al buscar: "+error.message; return; }
  if(!data) { result.innerHTML="‚ùå No se encontr√≥ el env√≠o"; return; }

  result.innerHTML = `
    <p>Cliente: ${data.cliente || "‚Äî"}</p>
    <p>Estado: ${data.estado}</p>
    <p>Ubicaci√≥n: ${data.ubicacion || "‚Äî"}</p>
    <p>Notas: ${data.notas || "‚Äî"}</p>
    <p>√öltima actualizaci√≥n: ${new Date(data.fecha_actualizacion).toLocaleString()}</p>
  `;
}
</script>
</body>
</html>
