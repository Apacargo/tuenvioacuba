<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rastreo ‚Ä¢ Apacargo</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: #f4f7fb;
      color: #222;
    }

    header {
      background: linear-gradient(90deg, #004aad, #d4af37);
      padding: 15px;
      text-align: center;
      color: white;
      font-size: 1.6rem;
      font-weight: 600;
    }

    main {
      max-width: 650px;
      margin: 40px auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 30px;
    }

    h2 {
      text-align: center;
      color: #004aad;
      margin-bottom: 20px;
    }

    input, select, textarea, button {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-family: inherit;
      font-size: 1rem;
    }

    button {
      background: #d4af37;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #b9932f;
    }

    .hidden { display: none; }

    .envio-item {
      border-left: 4px solid #004aad;
      background: #f8f9fd;
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 6px;
      position: relative;
    }

    .envio-id {
      font-weight: bold;
      color: #004aad;
    }

    .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff4d4d;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }

    .delete-btn:hover {
      background: #d93636;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding: 15px;
      background: #004aad;
      color: white;
      font-size: 0.9rem;
    }

    .note {
      font-size: 0.85rem;
      text-align: center;
      color: #555;
    }
  </style>
</head>

<body>
  <header>üì¶ Rastreo de Env√≠os ‚Äì Apacargo</header>

  <main>
    <section id="rastreo">
      <h2>Rastreo de env√≠o</h2>
      <p>Introduce tu n√∫mero de seguimiento (ej.: <strong>AP-2025-000123</strong>)</p>
      <div class="tracker">
        <input id="trackInput" placeholder="Ej: AP-2025-000123" />
        <button onclick="trackLookup()">Rastrear</button>
      </div>
      <div id="trackResult"></div>

      <div class="note">Si eres administrador, accede con usuario y contrase√±a.</div>
    </section>

    <!-- Login oculto -->
    <section id="login" class="hidden">
      <h2>Panel Administrativo</h2>
      <input type="text" id="user" placeholder="Usuario">
      <input type="password" id="pass" placeholder="Contrase√±a">
      <button onclick="login()">Entrar</button>
      <p id="loginMsg" style="color:red;text-align:center;"></p>
    </section>

    <!-- Panel del admin -->
    <section id="panel" class="hidden">
      <h2>Actualizar Estado de Env√≠o</h2>
      <button style="background:#004aad;margin-bottom:15px;" onclick="logout()">Cerrar Sesi√≥n</button>
      <form id="updateForm" onsubmit="updateShipment(event)">
        <input type="text" id="trackId" placeholder="N√∫mero de seguimiento" required>
        <select id="status" required>
          <option value="">Seleccionar estado</option>
          <option value="En preparaci√≥n">En preparaci√≥n</option>
          <option value="En tr√°nsito">En tr√°nsito</option>
          <option value="En aduana">En aduana</option>
          <option value="Listo para entrega">Listo para entrega</option>
          <option value="Entregado">Entregado</option>
        </select>
        <input type="text" id="location" placeholder="Ubicaci√≥n actual" required>
        <textarea id="notes" placeholder="Notas (opcional)"></textarea>
        <button type="submit">Actualizar Env√≠o</button>
      </form>

      <p id="updateMessage" style="text-align:center;color:green;"></p>

      <h3>√öltimos env√≠os actualizados</h3>
      <div id="enviosList"></div>
    </section>
  </main>

  <footer>¬© 2025 Apacargo ‚Äî Todos los derechos reservados.</footer>

  <script>
    const ADMIN_USER = "admin";
    const ADMIN_PASS = "Apacargo2025"; // üîí cambia esta contrase√±a

    let envios = JSON.parse(localStorage.getItem("envios") || "[]");

    function renderEnvios() {
      const list = document.getElementById("enviosList");
      list.innerHTML = "";
      envios.forEach((e, index) => {
        const div = document.createElement("div");
        div.classList.add("envio-item");
        div.innerHTML = `
          <button class="delete-btn" onclick="deleteEnvio(${index})">√ó</button>
          <div class="envio-id">${e.id}</div>
          <div>Estado: ${e.status}</div>
          <div>Ubicaci√≥n: ${e.location}</div>
          ${e.notes ? `<div>Notas: ${e.notes}</div>` : ""}
        `;
        list.prepend(div);
      });
    }

    function trackLookup() {
      const id = document.getElementById("trackInput").value.trim();
      const result = document.getElementById("trackResult");
      if (!id) {
        result.innerHTML = "<p style='color:red;'>‚ö†Ô∏è Ingresa un n√∫mero de seguimiento v√°lido.</p>";
        return;
      }

      const envio = envios.find(e => e.id === id);
      if (envio) {
        result.innerHTML = `
          <div class="envio-item">
            <div class="envio-id">${envio.id}</div>
            <div>Estado: ${envio.status}</div>
            <div>Ubicaci√≥n: ${envio.location}</div>
            ${envio.notes ? `<div>Notas: ${envio.notes}</div>` : ""}
          </div>
        `;
      } else {
        result.innerHTML = `<p style='color:red;'>‚ùå No se encontr√≥ ning√∫n env√≠o con ese n√∫mero.</p>`;
      }
    }

    function login() {
      const u = document.getElementById("user").value.trim();
      const p = document.getElementById("pass").value.trim();
      const msg = document.getElementById("loginMsg");

      if (u === ADMIN_USER && p === ADMIN_PASS) {
        document.getElementById("login").classList.add("hidden");
        document.getElementById("panel").classList.remove("hidden");
        msg.textContent = "";
        localStorage.setItem("adminLogged", "true");
        renderEnvios();
      } else {
        msg.textContent = "‚ùå Usuario o contrase√±a incorrectos.";
      }
    }

    function logout() {
      localStorage.removeItem("adminLogged");
      document.getElementById("panel").classList.add("hidden");
      document.getElementById("login").classList.remove("hidden");
      document.getElementById("user").value = "";
      document.getElementById("pass").value = "";
    }

    function updateShipment(e) {
      e.preventDefault();
      const id = document.getElementById("trackId").value.trim();
      const status = document.getElementById("status").value;
      const location = document.getElementById("location").value.trim();
      const notes = document.getElementById("notes").value.trim();
      const msg = document.getElementById("updateMessage");

      if (!id || !status || !location) {
        msg.textContent = "‚ö†Ô∏è Completa todos los campos obligatorios.";
        return false;
      }

      const existing = envios.findIndex(e => e.id === id);
      if (existing >= 0) {
        envios[existing] = { id, status, location, notes };
      } else {
        envios.push({ id, status, location, notes });
      }

      localStorage.setItem("envios", JSON.stringify(envios));
      msg.textContent = "‚úÖ Env√≠o actualizado correctamente.";
      renderEnvios();
      document.getElementById("updateForm").reset();
    }

    function deleteEnvio(index) {
      if (confirm("¬øEliminar este env√≠o del sistema?")) {
        envios.splice(index, 1);
        localStorage.setItem("envios", JSON.stringify(envios));
        renderEnvios();
      }
    }

    window.onload = () => {
      if (localStorage.getItem("adminLogged") === "true") {
        document.getElementById("login").classList.add("hidden");
        document.getElementById("panel").classList.remove("hidden");
        renderEnvios();
      } else {
        // acceso secreto: escribir "admin" en el campo de rastreo
        document.getElementById("trackInput").addEventListener("input", (e) => {
          if (e.target.value.toLowerCase() === "admin") {
            document.getElementById("rastreo").classList.add("hidden");
            document.getElementById("login").classList.remove("hidden");
            e.target.value = "";
          }
        });
      }
    };
  </script>
</body>
</html>
