<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rastreo de Env√≠os ‚Ä¢ Apacargo</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="supabaseClient.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <img src="images/logo.png" alt="Apacargo" class="brand-logo">
        <div>
          <div class="brand-name">Apacargo</div>
          <div class="brand-sub">Rastreo</div>
        </div>
      </a>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="container">
        <h2>Rastreo de env√≠o</h2>
        <p>Introduce tu n√∫mero de seguimiento (Ej: AP-2025-000123)</p>
        <div class="tracker">
          <input id="trackId" placeholder="Ej: AP-2025-000123" />
          <button class="btn btn-primary" id="trackBtn">Rastrear</button>
        </div>

        <div id="trackResult" class="track-result"></div>

        <div class="note small">
          <p>Si eres administrador, <a href="#" id="adminAccess">haz clic aqu√≠</a>.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div><strong>Apacargo</strong></div>
      <div class="socials"><a href="index.html">Volver</a></div>
    </div>
  </footer>

  <script type="module">
    import { supabase } from './supabaseClient.js'

    const input = document.getElementById('trackId')
    const result = document.getElementById('trackResult')
    const btn = document.getElementById('trackBtn')
    const adminAccess = document.getElementById('adminAccess')

    btn.addEventListener('click', async () => {
      const codigo = input.value.trim()
      if (!codigo) {
        result.innerHTML = "<p>Por favor, ingresa un c√≥digo v√°lido.</p>"
        return
      }

      const { data, error } = await supabase
        .from('rastreo')
        .select('*')
        .eq('codigo', codigo)
        .maybeSingle()

      if (error || !data) {
        result.innerHTML = "<p>No se encontr√≥ informaci√≥n para este n√∫mero.</p>"
        return
      }

      result.innerHTML = `
        <div class="card">
          <h3>üì¶ Env√≠o encontrado</h3>
          <p><strong>Cliente:</strong> ${data.cliente}</p>
          <p><strong>Estado:</strong> ${data.estado}</p>
          <p><strong>Ubicaci√≥n:</strong> ${data.ubicacion}</p>
          <p><strong>Notas:</strong> ${data.notas || 'Sin notas'}</p>
          <p><strong>√öltima actualizaci√≥n:</strong> ${new Date(data.fecha_actualizacion).toLocaleString()}</p>
        </div>
      `
    })

    adminAccess.addEventListener('click', () => {
      const pass = prompt("Introduce la clave secreta del administrador:")
      if (pass === "apacargo2025") {
        window.location.href = "admin.html"
      } else {
        alert("Clave incorrecta.")
      }
    })
  </script>
</body>
</html>
